variables:
  POSTGRES_USER: admin
  POSTGRES_PASSWORD: admin
  POSTGRES_DB: edu
  DATABASE_PORT: 54328
  DATABASE_HOST: localhost
  POSTGRES_SSL: disable
  POSTGRES_TIMEZONE: Asia/Tehran
  POETRY_VIRTUALENVS_CREATE: "false"  # This is to ensure poetry uses the system Python

default:
  image: ubuntu:20.04

  services:
    - postgres:12.2-alpine

  cache:
    paths:
      - ~/.cache/pip/

  before_script:
    - apt -y update
    - apt -y install apt-utils
    - apt -y install net-tools python3.8 python3-pip mysql-client libmysqlclient-dev
    - apt -y upgrade
    - python -m pip install poetry
    - poetry install


migrations:
  stage: build
  script:
    - poetry run python manage.py migrate


django-tests:
  stage: test
  script:
    - poetry run pytest




